<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Webscripting1 &mdash; Serverside Webscripting &mdash; 08.templates</title>

		<meta name="description" content="Webscripting1 &mdash; Serverside Webscripting &mdash; 08.templates">
		<meta name="author" content="Bram(us) Van Damme - ikdoeict.be">

		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<link rel="stylesheet" href="lib/zenburn.css">

		<style>
			.columns .column {
				float: left;
				list-style: none;
				margin: 0 0 12px 0;
				padding: 0;
			}

			.column-12 {
				width: 50%;
				text-align: center;
			}
			code {
				color: gainsboro;
			}

			li > code, li em > code, li del > code, li ins > code, p > code {
				background: #3F3F3F;
				padding: 2px 4px;
				box-shadow: 0px 0px 6px rgba(0,0,0,0.3);
				font-size: 80%;
			}

			del code, code.nok {
				color: #C55;
			}

			ins code, code.ok {
				color: #5C5;
			}

			strong {
				color: #553d00;
				background: transparent url('assets/02/strong.png') no-repeat 50% 50%;
				font-size: 80%;
				padding: 0 4px;
				font-family: palatino, times;
				font-weight: 300;
				font-style: italic;
			}

			#reveal section img.noborder {
				background: transparent;
				border: 0;
				-webkit-box-shadow: none;
				-moz-box-shadow: none;
				-ms-box-shadow: none;
				-o-box-shadow: none;
				box-shadow: none;"
			}

			#reveal .hastooltip {
				position: relative;
			}

			#reveal .hastooltip .tooltip {
				position: absolute;
				bottom: 5px;
				right: 5px;
				background-image: url('assets/comments.png');
				background-position: bottom right;
				background-repeat: no-repeat;
				width: 60px;
				height: 60px;
				z-index: 110;
			}

			#reveal .tooltip div {
				display: none;
				position: absolute;
				bottom: 30px;
				right: 40px;
				font-size: 50%;
				line-height: 1.48;
				min-width: 420px;
				opacity: 0.9;
				border: 2px solid #ccc;
				padding: 20px;
				background-color: #ffc;
				background-image: -webkit-linear-gradient(rgba(255,255,255,.5), rgba(255,255,180,0));
				background-image: -moz-linear-gradient(rgba(255,255,255,.5), rgba(255,255,180,0));
				background-image: -ms-linear-gradient(rgba(255,255,255,.5), rgba(255,255,180,0));
				background-image: -o-linear-gradient(rgba(255,255,255,.5), rgba(255,255,180,0));
				background-image: linear-gradient(rgba(255,255,255,.5), rgba(255,255,180,0));
				border-radius: 4px;
				box-shadow: 0 1px 2px rgba(0,0,0,.4), 0 1px 0 rgba(255,255,255,.5) inset;
				text-shadow: 0 1px 0 rgba(255,255,255,.4);
				color: #333;
			}

			#reveal .tooltip:hover div {
				display: block;
			}

			#reveal .tooltip ul {
				margin: 5px 5px 5px 15px;
			}

			#reveal .tooltip ul li {
				margin-left: 10px;
			}

			#reveal .tooltip div *:last-child {
				margin-bottom: 0;
			}

			figure.zoomable-20:hover {
				-moz-transform: scale(2);
				-o-transform: scale(2);
				-webkit-transform: scale(2);
				transform: scale(2);
			}

		</style>

		<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-107008-28']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>

	</head>

	<body>

		<div id="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">


				<!-- 0 : Title -->
				<section>

					<section>
						<h3 class="inverted">Serverside Webscripting <small>[JLW322]</small></h3>
						<h1>08.templates</h1>

						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:bramus.vandamme@kahosl.be">bramus.vandamme@kahosl.be</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>

				</section>




				<section>

					<section>
						<h2>Introducing Templates</h2>
					</section>

					<section>
						<h2>Typical PHP page</h2>

						<ul>
							<li class="fragment">
								Follows a certain structure
								<ul class="fragment">
									<li>Logic at the top</li>
									<li>Display at the bottom</li>
								</ul>
							</li>
						</ul>

						<div class="fragment">
							<pre class="bigger"><code class="language-php" data-overlay-example="assets/08/examples/idea/01/index.php">&lt;?php

	// define our vars (fixed or via calculations)
	$title = 'testpage';
	$userName = 'bramus';
	$weatherToday = 'cloudy';

?&gt;&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;&lt;?php echo htmlentities($title); ?&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  Hi there &lt;?php echo htmlentities($userName); ?&gt;, the weather today is &lt;?php echo htmlentities($weatherToday); ?&gt;.
&lt;/body&gt;
&lt;/html&gt;</code></pre>
						</div>
					</section>

					<section>
						<h2>Introducing Templates</h2>
						<ul>
							<li class="fragment">
								Split out the HTML from our PHP logic:
								<ol>
									<li class="fragment">Put all the HTML into a separate file and provide <em>named placeholders</em> where to show variables</li>
									<li class="fragment">In the remaining PHP code, keep the logic in place. Add code to load in the template and <em>assign</em> values to the template variables</li>
								</ol>
							</li>
							<li class="fragment">
								Naming conventions:
								<ul>
									<li class="fragment">
										Give the template file a <code>.tpl</code> extension
									</li>
									<li class="fragment">
										Put variables between <code>{{ </code> and <code> }}</code> in the template, e.g. <code>{{ firstName }}</code>
									</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Basic Execution</h2>

						<div class="fragment"><pre class="bigger"><code class="language-html dontrun">&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;{{ title }}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  Hi there {{ user }}, the weather today is {{ weather }}.
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>

						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/08/examples/idea/02/index.php">&lt;?php

$title = 'testpage';
$userName = 'bramus';
$weatherToday = 'cloudy';

$tplContent = <span class="fragment">file_get_contents(__DIR__ . '/templates/main.tpl');

</span><span class="fragment">$tplContent = </span><span class="fragment">str_replace('{{ title }}', htmlentities($title), $tplContent);
</span><span class="fragment">$tplContent = str_replace('{{ user }}', htmlentities($userName), $tplContent);
</span><span class="fragment">$tplContent = str_replace('{{ weather }}', htmlentities($weatherToday), $tplContent);

</span><span class="fragment">echo $tplContent;</span></code></pre></div>

					</section>

					<section>
						<h2>OO Execution (1)</h2>
						<ul>
							<li class="fragment">
								Let's put this logic into a <em>(very basic)</em> class
								<pre class="bigger" style="height: 380px; overflow-y: scroll;"><code class="language-php">&lt;?php

class Template {

	private $content;

	public function __construct($template = null) {
		if($template) $this-&gt;loadTemplate($template);
	}

	public function loadTemplate($template) {
		$this-&gt;content = file_get_contents($template);
	}

	public function render($data) {
		foreach ($data as $key =&gt; $value) {
			$this-&gt;content = str_replace(
				'{{ '. $key .' }}', htmlentities($value),
				$this-&gt;content
			);
		}
		return $this-&gt;content;
	}
}

// EOF</code></pre>
							</li>
						</ul>
						<footer class="fragment"><em>Note: this class doesn't do any checking yet!</em></footer>
					</section>

					<section>
						<h2>OO Execution (2)</h2>
						<ul>
							<li class="fragment">
								Class usage:
								<pre class="bigger"><code class="language-php" data-overlay-example="assets/08/examples/idea/03/index.php">&lt;?php

	// includes &amp; requires
	require_once __DIR__ . '/includes/classes/template.php';

	// define our vars (fixed or via calculations)
	$title = 'testpage';
	$userName = 'bramus';
	$weatherToday = 'cloudy';

<span class="fragment">	// load template
	$tpl = new Template();
	$tpl-&gt;loadTemplate(__DIR__ . '/templates/main.tpl');

</span><span class="fragment">	// render template with our data
	// @note The template class with automatically prevent XSS for us :-)
	</span><span class="fragment">echo $tpl-&gt;render(array(
		'title' =&gt; $title,
		'user' =&gt; $userName,
		'weather' =&gt; $weatherToday
	));</span><span class="fragment">

// EOF</span></code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Cool! What now?</h2>
						<ul>
							<li class="fragment">
								We've successfully separated the PHP logic and rendering of our HTML.
							</li>
							<li class="fragment" style="margin-top: 1em;">
								The <code>Template</code> class is very basic. Possible improvements:
								<ul>
									<li class="fragment">Support <code>if</code> structures in our templates</li>
									<li class="fragment">Support <code>for</code> and <code>foreach</code> structures in our templates</li>
									<li class="fragment">Variable modifiers <em>(filters)</em> within our template (think <code>ucfirst</code>)</li>
									<li class="fragment">&hellip;</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								We could implement this ourselves &hellip;
								<ul>
									<li class="fragment">&hellip; yet some bright minds have already pondered on the subject and have come up with a robust solution</li>
								</ul>
							</li>
						</ul>
					</section>

				</section>



				<section>

					<section>
						<h2>Introducing Twig</h2>

						<p><img src="assets/08/splash-twig.jpg" width="900" alt="" /></p>

					</section>

					<section>
						<h2>Twig</h2>
						<ul>
							<li class="fragment">
								PHP Templating Library
								<ul>
									<li>= Set of classes to working with templates</li>
									<li>Website: <a href="http://twig.sensiolabs.org/">http://twig.sensiolabs.org/</a></li>
									<li>Documentation: <a href="http://twig.sensiolabs.org/documentation">http://twig.sensiolabs.org/documentation</a></li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Why Twig and not X?
								<ul>
									<li>Modern code, Template oriented syntax, Fast, Supports caching, Template Inheritance, Flexible, Extensible, &hellip;</li>
									<li class="fragment">Twig prevents XSS as it <em>escapes</em> variables by default</li>
								</ul>
							</li>
						</ul>

					</section>

					<section>
						<h2>Obtaining Twig</h2>

						<ol>
							<li class="fragment">
								Download<small>(*)</small> Twig from <a href="https://github.com/fabpot/Twig/tags">https://github.com/fabpot/Twig/tags</a>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Place the <code>Twig</code> folder from the <code>.zip</code> into the <code>includes/</code> folder of your project
								<div style="text-align: center;"><figure class="zoomable-20"><img src="assets/08/twig-ondisk.jpg" width="200" alt="" title="" /><figcaption>Twig on disk</figcaption></figure></div>
							</li>
						</ol>


						<footer class="fragment"><em>(*) In Webscripting 2 we'll learn how to include Twig using Composer</em></footer>
					</section>

					<section>
						<h2>Using Twig into your project</h2>

						<ol>
							<li class="fragment">
								Instead of manually including each class that ships with Twig, just include the Twig autoloader<small>(*)</small>.
								<pre class="bigger"><code class="language-php">require_once __DIR__ . '/includes/Twig/Autoloader.php';
Twig_Autoloader::register();</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								<em>Bootstrap</em> Twig, pointing it to the <code>templates/</code> folder
								<pre class="bigger"><code class="language-php">$loader = new Twig_Loader_Filesystem(__DIR__ . '/templates');
$twig = new Twig_Environment($loader);</code></pre>
							</li>

							<li class="fragment" style="margin-top: 1em;">
								Load in your template and render it <em>(see next slide)</em>
								<ul>
									<li>We'll rename our <code>.tpl</code> files to <code>.twig</code></li>
								</ul>
							</li>
						</ol>

						<footer class="fragment"><em>(*) In Webscripting 2 we'll talk about autoloaders and PSR-0 in detail</em></footer>
					</section>

					<section>
						<h2>Your first Twig Template</h2>

						<ul>
							<li class="fragment">
								The syntax of our <del><code>.tpl</code></del> <ins><code>.twig</code></ins> file hasn't changed
								<pre class="bigger"><code class="language-html dontrun">&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;{{ title }}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  Hi there {{ user }}, the weather today is {{ weather }}.
&lt;/body&gt;
&lt;/html&gt;</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								The PHP code is quite similar
								<pre class="bigger"><code class="language-php" data-overlay-example="assets/08/examples/twig/04/index.php">// Assuming we've already included and bootstrapped Twig

$tpl = $twig->loadTemplate('main.twig');
echo $tpl->render(array(
	'title' => $title,
	'user' => $userName,
	'weather' => $weatherToday
));</code></pre>
						</ul>

					</section>

				</section>

				<section>
					<section>
						<h2>Exploring Twig</h2>
					</section>
				</section>





				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:bramus.vandamme@kahosl.be">bramus.vandamme@kahosl.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Sources -->
				<section id="sources">
					<section>
						<h2>Sources</h2>
						<ul>

						</ul>
					</section>
				</section>

			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>

			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>

		</div>

		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>