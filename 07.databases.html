<!doctype html>  
<html lang="en">
	
	<head>
		<meta charset="utf-8">
		
		<title>Webscripting1 &mdash; Serverside Webscripting &mdash; 07.databases</title>

		<meta name="description" content="Webscripting1 &mdash; Serverside Webscripting &mdash; 07.databases">
		<meta name="author" content="Bram(us) Van Damme - ikdoeict.be">
		
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<link rel="stylesheet" href="lib/zenburn.css">

		<style>
			.columns .column {
				float: left;
				list-style: none;
				margin: 0 0 12px 0;
				padding: 0;
			}

			.column-12 {
				width: 50%;
				text-align: center;
			}
			code {
				color: gainsboro;
			}

			li > code, li em > code, li del > code, li ins > code, p > code {
				background: #3F3F3F;
				padding: 2px 4px;
				box-shadow: 0px 0px 6px rgba(0,0,0,0.3);
				font-size: 80%;
			}

			strong {
				color: #553d00;
				background: transparent url('assets/02/strong.png') no-repeat 50% 50%;
				font-size: 80%;
				padding: 0 4px;
				font-family: palatino, times;
				font-weight: 300;
				font-style: italic;
			}

			#reveal section img.noborder {
				background: transparent;
				border: 0;
				-webkit-box-shadow: none;
				-moz-box-shadow: none;
				-ms-box-shadow: none;
				-o-box-shadow: none;
				box-shadow: none;"
			}
		</style>
	</head>
	
	<body>
		
		<div id="reveal">
			
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">


				<!-- 0 : Title -->
				<section>

					<section>
						<h3 class="inverted">Serverside Webscripting <small>[JLW274]</small></h3>
						<h1>07.databases</h1>
					
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:bramus.vandamme@kahosl.be">bramus.vandamme@kahosl.be</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>

				</section>




				<section>

					<section>
						<h2>Intro</h2>
					</section>

					<section>
						<h2>Choose your flavor</h2>

						<ul>
							<li class="fragment">
								Connecting to a database server from PHP possible by means of an extension
							</li>
							<li class="fragment">
								Extensions are available for most database servers
								<ul>
									<li class="fragment">MySQL, MS SQL, Oracle, &hellip;</li>
								</ul>
							</li>
							<li class="fragment">
								To connect to a MySQL server, 3 extensions exist
								<ul>
									<li class="fragment"><code>mysql</code> &mdash; Classic extension, procedural (= based on methods)</li>
									<li class="fragment"><code>mysql</code> &mdash; Improved version of the <code>mysql</code> extension. Supports Prepared Statements, Multiple Statements, Transactions, etc. Both OO and procedural</li>
									<li class="fragment"><code>pdo_mysql</code> &mdash; OO based; Implements PHP Data Objects, an interface to communicating with a database server.</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>We'll choose</h2>

						<ul>
							<li class="fragment">
								DBMS? MySQL
								<ul>
									<li class="fragment">We've already worked with this</li>
									<li class="fragment">Free</li>
								</ul>
							</li>
							<li class="fragment">
								Extension? <code>mysqli</code>
								<ul>
									<li>Better than <code>mysql</code></li>
									<li><code>pdo_mysql</code> a tad above our level, for now</li>
								</ul>
							</li>
							<li class="fragment">
								OO or procedural? Procedural
								<ul>
									<li class="fragment">Most examples online are <code>mysql</code> based. Changing to the <code>mysqli</code> version is only a matter of changing the prefix of the function</li>
									<li class="fragment">If you know how to work procedural, and understand OO well, it's a very small step towards the OO version</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Activating mysqli</h2>

						<ul>
							<li class="fragment">
								Activate via <code>php.ini</code>
								<ul>
									<li class="fragment">
										Remove the leading <code>;</code> to activate<br />
										<div style="text-align: center;"><figure><img src="assets/07/phpini.jpg" alt="" title="" /></figure></div>
									</li>
									<li class="fragment">Already activated in Wampserver</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Verify activation</h2>

						<ul>
							<li class="fragment">
								Use <code>phpinfo()</code> and check if <code>mysqli</code> appears on the page<br />
							</li>
						</ul>
						<div style="text-align: center;" class="fragment"><figure><img src="assets/07/phpinfo.jpg" alt="" title="" width="500" /></figure></div>
					</section>


				</section>




				<section>

					<section>
						<h2>Connecting &amp; Disconnecting</h2>
					</section>

					<section>
						<h2>First of all</h2>

						<ul>
							<li class="fragment">
								We use a <code>config.php</code> to store our credentials in

								<pre class="bigger"><code class="language-php">&lt;?php
	
		define('DB_HOST', 'localhost');
		define('DB_USER', 'root');
		define('DB_PASS', 'Azerty123');
	
		define('DB_NAME_FF', 'fotofactory');
		define('DB_NAME_STATUS', 'status');

//EOF</code></pre>
							</li>
							<li class="fragment">Edit the file if needed (location: <code>/assets/07/examples</code>)</li>
							<li class="fragment">SQL Dumps of the used databases can also be found in that folder</li>
						</ul>
					</section>

					<section>
						<h2>Connecting (1)</h2>

						<ul>
							<li class="fragment">Connect using <code>mysqli_connect()</code></li>
							<li class="fragment">Select database using <code>mysqli_select_db()</code></li>
						</ul>
						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/07/examples/01.php">&lt;?php

	require_once 'config.php';

	$dbhandler = @mysqli_connect(DB_HOST, DB_USER, DB_PASS)
		or die ('Could not connect to database server');
		
	// If connection succeeded, we end up here.
	// If not, the die() above gets interpreted
	echo 'Connected';
	
	// Select database &quot;fotofactory&quot;
	@mysqli_select_db($dbhandler, DB_NAME_FF)
		or die ('Could not select database');
	
	echo ' and selected the DB';
	
	// ... your query magic here

//EOF</code></pre></div>
					</section>

					<section>
						<h2>Connecting (2)</h2>

						<ul>
							<li class="fragment">Connect and selecting database in one line is possible</li>
						</ul>
						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/07/examples/01b.php">&lt;?php

	require_once 'config.php';

	$dbhandler = @mysqli_connect(DB_HOST, DB_USER, DB_PASS, DB_NAME_FF)
		or die ('Could not connect to database server or access database');
		
	echo 'Connected and selected the DB (in one go)';
	
	// ... your query magic here

//EOF</code></pre></div>
					</section>

					<section>
						<h2>Connecting (3)</h2>

						<ul>
							<li class="fragment">
								Why store the connection in a variable?
								<ul>
									<li class="fragment">Needed to run queries on</li>
									<li class="fragment">Needed to catch errors</li>
									<li class="fragment">Needed to disconnect</li>
								</ul>
							</li>
							<li class="fragment">
								Practical use case?
								<ul>
									<li class="fragment">A setup where multiple MySQL servers are used: you write on one connection, and read from an other connection</li>
									<li class="fragment">Example: Wikipedia uses a Master-Slave MySQL setup: writes happen on the master, reads on the slaves</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Disconnecting</h2>

						<ul>
							<li class="fragment">use <code>mysqli_close()</code></li>
						</ul>
						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/07/examples/01c.php">&lt;?php

	require_once 'config.php';

	$dbhandler = @mysqli_connect(DB_HOST, DB_USER, DB_PASS, DB_NAME_FF)
		or die ('Could not connect to database server or access database');
		
	echo 'Connected and selected the DB (in one go)';
	
	// ... your query magic here
	
	@mysqli_close($dbhandler);

//EOF</code></pre></div>
						<footer class="fragment">Note: If you don't, the connection gets closed automatically when the script has finished</footer>
					</section>

				</section>




				<section>

					<section>
						<h2>Catching Errors</h2>
					</section>

				</section>




				<section>

					<section>
						<h2>Executing Queries</h2>
					</section>

				</section>




				<section>

					<section>
						<h2>Securing Queries</h2>
					</section>

				</section>




				<section>

					<section>
						<h2>Best Practices</h2>
					</section>

				</section>




				<section>

					<section>
						<h2>And now?</h2>
					</section>


					<section>
						<h2>Now: Practice!</h2>
						<ul>
							<li class="fragment">See lab assignment</li>
						</ul>
					</section>

					<section>
						<h2>Advanced Webscripting: DBAL</h2>
						<ul>
							<li class="fragment">
								Later on we'll evolve towards a Database Access Layer
								<ul>
									<li class="fragment">
										Class that handles most for us, including the basic CRUD actions
										<ul class="fragment">
											<li>CRUD = Create, Read, Update, Delete</li>
											<li>Some specific functions such as <code>getNumRows()</code>, <code>getPairsAsArray()</code></li>
											<li>What this means to us: Write less queries!</li>
										</ul>
									</li>
									<li class="fragment">
										Depending on the type of query, we'll get a different result
										<ul class="fragment">
											<li><code>SELECT</code>: Resultset, as an array</li>
											<li><code>INSERT</code>: The inserted ID</li>
											<li><code>UPDATE</code>/<code>DELETE</code>: The number of affected rows</li>
										</ul>
									</li>
									<li class="fragment">
										Debugging, error handling, and code performance
										<ul class="fragment">
											<li>Keep track of executed queries</li>
											<li>Use of exceptions</li>
											<li>Singleton Pattern</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</section>

				</section>




				<section>

					<section>
						<h2>Extra: PhpMyAdmin</h2>
					</section>

					<section>
						<h2>Demo time!</h2>

						<figure><img src="assets/07/phpmyadmin.png" alt="" title="" width="600" /></figure>

					</section>

					<section>
						<h2>Demo Recap</h2>

						<ul>
							<li class="fragment">Import/Export databases</li>
							<li class="fragment">Create tables</li>
							<li class="fragment">Insert/Update data</li>
							<li class="fragment">Run Queries</li>
							<li class="fragment">Add users and set privileges</li>
						</ul>
						
					</section>

				</section>




				<section>

					<section>
						<h2>Want more?</h2>
					</section>

					<section>
						<h2 style="font-size: 180%">There's always room for improvement</h2>

						<ul>
							<li class="fragment">
								Learn to work with the OO based version of <code>mysqli</code>
							</li>
							<li class="fragment">
								Use Prepared Statements with <code>mysqli</code>
								<ul>
									<li>If used properly this will automatically protect against SQL Injection</li>
								</ul>
							</li>
							<li class="fragment">
								Learn to work with <code>pdo_mysql</code>
								<ul>
									<li>Don't forget to call <code>$dbh->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);</code> to make sure your prepared statements are real <em>(<a href="http://stackoverflow.com/a/60496">source</a>)</em></li>
								</ul>
							</li>
							<li class="fragment">
								Use a Database Abstraction Layer (DAL), or take it a step further and use an Object Relational Mapper (ORM)
								<ul>
									<li>Example: <a href="http://www.doctrine-project.org/">Doctrine</a></li>
								</ul>
							</li>
						</ul>
					</section>

				</section>

				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:bramus.vandamme@kahosl.be">bramus.vandamme@kahosl.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Sources -->
				<section id="sources">
					<section>
						<h2>Sources</h2>
						<ul>
							
						</ul>
					</section>
				</section>
				
			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>
			
			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>
			
			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>
			
		</div>
		
		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>